"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var RocketPreloadLinks=function(){function t(e){_classCallCheck(this,t),this.browser=e,this.listenerOptions=this.browser.options,this.processedLinks=new Set,this.addLinkTimeoutId=null,this.eventTime=null,this.listenerThreshold=1111,this.onHoverDelayTime=500}return _createClass(t,[{key:"init",value:function(){this.browser.supportsLinkPrefetch()&&!this.browser.isDataSaverModeOn()&&(this.processedLinks.add(window.location.href),this._addEventListeners(this))}},{key:"_addEventListeners",value:function(e){document.addEventListener("mouseover",e.triggerOnHover.bind(e),e.listenerOptions),document.addEventListener("mousedown",e.triggerOnClick.bind(e),e.listenerOptions),document.addEventListener("touchstart",e.triggerOnTap.bind(e),e.listenerOptions)}},{key:"_addPrefetchLink",value:function(e){if(!this.processedLinks.has(e)){var t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t),this.processedLinks.add(e)}}},{key:"triggerOnHover",value:function(e){var t=this;if(!(performance.now()-this.eventTime<this.listenerThreshold)){var i=e.target.closest("a");if(this._isLinkOk(i)){i.addEventListener("mouseout",this.resetOnHover.bind(this),{passive:!0}),this.addLinkTimeoutId=setTimeout(function(){t._addPrefetchLink(i.href),t.addLinkTimeoutId=void 0},this.onHoverDelayTime)}}}},{key:"triggerOnClick",value:function(e){var t=e.target.closest("a");this._isLinkOk(t)&&(this._addPrefetchLink(t.href),this._resetAddLinkTask())}},{key:"triggerOnTap",value:function(e){this.eventTime=performance.now(),this.triggerOnClick(e)}},{key:"resetOnHover",value:function(e){(e.relatedTarget&&e.target.closest("a")===e.relatedTarget.closest("a")||this.addLinkTimeoutId)&&this._resetAddLinkTask()}},{key:"_isLinkOk",value:function(e){return null!==e&&"object"===(void 0===e?"undefined":_typeof(e))&&(!!e.href&&!this.processedLinks.has(e.href))}},{key:"_resetAddLinkTask",value:function(){this.addLinkTimeoutId&&(clearTimeout(this.addLinkTimeoutId),this.addLinkTimeoutId=null)}}],[{key:"run",value:function(){new t(new RocketBrowserCompatabilityChecker({capture:!0,passive:!0})).init()}}]),t}();RocketPreloadLinks.run();