"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var RocketPreloadLinks=function(){function RocketPreloadLinks(browser,config){_classCallCheck(this,RocketPreloadLinks),this.browser=browser,this.config=config,this.listenerOptions=this.browser.options,this.pageUrl=this.config.siteUrl,this.processedLinks=new Set,this.addLinkTimeoutId=null,this.eventTime=null,this.listenerThreshold=1111,this.onHoverDelayTime=500}return _createClass(RocketPreloadLinks,[{key:"init",value:function(){this.browser.supportsLinkPrefetch()&&!this.browser.isDataSaverModeOn()&&(this.regex={excludeUris:RegExp(this.config.excludeUris,"i"),images:RegExp(".("+this.config.imageExtensions+")$","i"),fileExtensions:RegExp(".("+this.config.imageExtensions+"|php|pdf|html|htm)$","i")},this.processedLinks.add(window.location.href),this._addEventListeners(this))}},{key:"_addEventListeners",value:function(self){document.addEventListener("mouseover",self.triggerOnHover.bind(self),self.listenerOptions),document.addEventListener("mousedown",self.triggerOnClick.bind(self),self.listenerOptions),document.addEventListener("touchstart",self.triggerOnTap.bind(self),self.listenerOptions)}},{key:"_addPrefetchLink",value:function(url){if(!this.processedLinks.has(url.href)){var elem=document.createElement("link");elem.rel="prefetch",elem.href=url.href,document.head.appendChild(elem),this.processedLinks.add(url.href)}}},{key:"triggerOnHover",value:function(event){var _this=this;if(!(performance.now()-this.eventTime<this.listenerThreshold)){var _prepareUrl2=this._prepareUrl(event),_prepareUrl3=_slicedToArray(_prepareUrl2,2),url=_prepareUrl3[0],linkElem=_prepareUrl3[1];if(null!==url){linkElem.addEventListener("mouseout",this.resetOnHover.bind(this),{passive:!0}),this.addLinkTimeoutId=setTimeout(function(){_this._addPrefetchLink(url),_this.addLinkTimeoutId=void 0},this.onHoverDelayTime)}}}},{key:"triggerOnClick",value:function(event){var _prepareUrl4=this._prepareUrl(event),_prepareUrl5=_slicedToArray(_prepareUrl4,2),url=_prepareUrl5[0];_prepareUrl5[1];null!==url&&(this._addPrefetchLink(url),this._resetAddLinkTask())}},{key:"triggerOnTap",value:function(event){this.eventTime=performance.now(),this.triggerOnClick(event)}},{key:"resetOnHover",value:function(event){(event.relatedTarget&&event.target.closest("a")===event.relatedTarget.closest("a")||this.addLinkTimeoutId)&&this._resetAddLinkTask()}},{key:"_prepareUrl",value:function(event){var linkElem=event.target.closest("a");if(null===linkElem||"object"!==(void 0===linkElem?"undefined":_typeof(linkElem)))return[null,null];if(!1 in linkElem)return[null,null];if(!this._isHttpProtocol(linkElem))return[null,null];var href=linkElem.href,origin=href.substring(0,this.pageUrl.length),pathname=this._getPathname(href,origin),url={original:href,protocol:linkElem.protocol,origin:origin,pathname:pathname,href:origin+pathname};return this._isLinkOk(url)?[url,linkElem]:[null,null]}},{key:"_getPathname",value:function(url,origin){var pathname=origin?url.substring(this.pageUrl.length):url;return pathname.startsWith("/")||(pathname="/"+pathname),this._shouldAddTrailingSlash(pathname)?pathname+"/":pathname}},{key:"_shouldAddTrailingSlash",value:function(pathname){return this.config.usesTrailingSlash&&!pathname.endsWith("/")&&!this.regex.fileExtensions.test(pathname)}},{key:"_isLinkOk",value:function(url){return null!==url&&"object"===(void 0===url?"undefined":_typeof(url))&&(!this.processedLinks.has(url.href)&&(!!this._isInternal(url)&&(!this._isQueryString(url.href)&&(!this._isAnchor(url.href)&&(!this._isExcluded(url.href)&&!this._isImage(url.href))))))}},{key:"_isAnchor",value:function(href){return-1!==href.indexOf("#")}},{key:"_isExcluded",value:function(url){return this.regex.excludeUris.test(url)}},{key:"_isHttpProtocol",value:function(linkElem){return"http:"===linkElem.protocol||"https:"===linkElem.protocol}},{key:"_isImage",value:function(href){return this.regex.images.test(href)}},{key:"_isInternal",value:function(url){return url.origin===this.pageUrl}},{key:"_isQueryString",value:function(href){return-1!==href.indexOf("?")}},{key:"_resetAddLinkTask",value:function(){this.addLinkTimeoutId&&(clearTimeout(this.addLinkTimeoutId),this.addLinkTimeoutId=null)}}],[{key:"run",value:function(){if("undefined"!=typeof RocketPreloadLinksConfig){new RocketPreloadLinks(new RocketBrowserCompatibilityChecker({capture:!0,passive:!0}),RocketPreloadLinksConfig).init()}}}]),RocketPreloadLinks}();RocketPreloadLinks.run();