"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},e=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function n(e,t){i(this,n),this.browser=e,this.config=t,this.options=this.browser.options,this.prefetched=new Set,this.onhoverId=null,this.eventTime=null,this.threshold=1111,this.numOnHover=0}return e(n,[{key:"init",value:function(){this.browser.supportsLinkPrefetch()&&!this.browser.isDataSaverModeOn()&&(this.regex={excludeUris:RegExp(this.config.excludeUris,"i"),images:RegExp(".("+this.config.imageExt+")$","i"),fileExt:RegExp(".("+this.config.fileExt+")$","i")},this.prefetched.add(window.location.href),this._initListeners(this))}},{key:"_initListeners",value:function(e){-1<this.config.onHoverDelay&&document.addEventListener("mouseover",e.triggerOnHover.bind(e),e.listenerOptions),document.addEventListener("mousedown",e.triggerOnClick.bind(e),e.listenerOptions),document.addEventListener("touchstart",e.triggerOnTap.bind(e),e.listenerOptions)}},{key:"triggerOnHover",value:function(e){var t,n,i,r,o=this;performance.now()-this.eventTime<this.threshold||(t=this._prepareUrl(e),n=s(t,2),i=n[0],r=n[1],null!==i&&(r.addEventListener("mouseout",this.resetOnHover.bind(this),{passive:!0}),this.onhoverId=setTimeout(function(){if(o.onhoverId=void 0,0===o.numOnHover)setTimeout(function(){return o.numOnHover=0},1e3);else if(o.numOnHover>o.config.rateThrottle)return;o.numOnHover++,o._addPrefetchLink(i)},this.config.onHoverDelay)))}},{key:"triggerOnClick",value:function(e){var t=this._prepareUrl(e),n=s(t,2),i=n[0];n[1];null!==i&&(this._addPrefetchLink(i),this._resetAddLinkTask())}},{key:"triggerOnTap",value:function(e){this.eventTime=performance.now(),this.triggerOnClick(e)}},{key:"_addPrefetchLink",value:function(e){var t;this.prefetched.has(e.href)||((t=document.createElement("link")).rel="prefetch",t.href=e.href,document.head.appendChild(t),this.prefetched.add(e.href))}},{key:"resetOnHover",value:function(e){(e.relatedTarget&&e.target.closest("a")===e.relatedTarget.closest("a")||this.onhoverId)&&this._resetAddLinkTask()}},{key:"_prepareUrl",value:function(e){var t=e.target.closest("a");if(null===t||"object"!==(void 0===t?"undefined":o(t))||!1 in t||-1===["http:","https:"].indexOf(t.protocol))return[null,null];var n=t.href.substring(0,this.config.siteUrl.length),i=this._getPathname(t.href,n),r={original:t.href,protocol:t.protocol,origin:n,pathname:i,href:n+i};return this._isLinkOk(r)?[r,t]:[null,null]}},{key:"_getPathname",value:function(e,t){var n=t?e.substring(this.config.siteUrl.length):e;return n.startsWith("/")||(n="/"+n),this._shouldAddTrailingSlash(n)?n+"/":n}},{key:"_shouldAddTrailingSlash",value:function(e){return this.config.usesTrailingSlash&&!e.endsWith("/")&&!this.regex.fileExt.test(e)}},{key:"_isLinkOk",value:function(e){return null!==e&&"object"===(void 0===e?"undefined":o(e))&&(!this.prefetched.has(e.href)&&e.origin===this.config.siteUrl&&-1===e.href.indexOf("?")&&-1===e.href.indexOf("#")&&!this.regex.excludeUris.test(e.href)&&!this.regex.images.test(e.href))}},{key:"_resetAddLinkTask",value:function(){this.onhoverId&&(clearTimeout(this.onhoverId),this.onhoverId=null)}}],[{key:"run",value:function(){"undefined"!=typeof RocketPreloadLinksConfig&&new n(new RocketBrowserCompatibilityChecker({capture:!0,passive:!0}),RocketPreloadLinksConfig).init()}}]),n}();t.run();