"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);n=!0);}catch(e){r=!0,s=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},e=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function i(e,t){n(this,i),this.browser=e,this.config=t,this.listenerOptions=this.browser.options,this.pageUrl=window.location.origin,this.processedLinks=new Set,this.addLinkTimeoutId=null,this.eventTime=null,this.listenerThreshold=1111,this.onHoverDelayTime=500}return e(i,[{key:"init",value:function(){this.browser.supportsLinkPrefetch()&&!this.browser.isDataSaverModeOn()&&(this.regex={excludeUris:RegExp("("+this.config.excludeUris+")","i"),images:RegExp(".("+this.config.imageExtensions+")$","i"),fileExtensions:RegExp(".("+this.config.imageExtensions+"|php|pdf|html|htm)$","i")},this.processedLinks.add(window.location.href),this._addEventListeners(this))}},{key:"_addEventListeners",value:function(e){document.addEventListener("mouseover",e.triggerOnHover.bind(e),e.listenerOptions),document.addEventListener("mousedown",e.triggerOnClick.bind(e),e.listenerOptions),document.addEventListener("touchstart",e.triggerOnTap.bind(e),e.listenerOptions)}},{key:"_addPrefetchLink",value:function(e){if(!this.processedLinks.has(e.href)){var t=document.createElement("link");t.rel="prefetch",t.href=e.href,document.head.appendChild(t),this.processedLinks.add(e.href)}}},{key:"triggerOnHover",value:function(e){var t=this;if(!(performance.now()-this.eventTime<this.listenerThreshold)){var i=this._prepareUrl(e),n=a(i,2),r=n[0],s=n[1];if(null!==r){s.addEventListener("mouseout",this.resetOnHover.bind(this),{passive:!0}),this.addLinkTimeoutId=setTimeout(function(){t._addPrefetchLink(r),t.addLinkTimeoutId=void 0},this.onHoverDelayTime)}}}},{key:"triggerOnClick",value:function(e){var t=this._prepareUrl(e),i=a(t,2),n=i[0];i[1];null!==n&&(this._addPrefetchLink(n),this._resetAddLinkTask())}},{key:"triggerOnTap",value:function(e){this.eventTime=performance.now(),this.triggerOnClick(e)}},{key:"resetOnHover",value:function(e){(e.relatedTarget&&e.target.closest("a")===e.relatedTarget.closest("a")||this.addLinkTimeoutId)&&this._resetAddLinkTask()}},{key:"_prepareUrl",value:function(e){var t=e.target.closest("a");if(null===t||"object"!==(void 0===t?"undefined":o(t)))return[null,null];if(!1 in t)return[null,null];if(!this._isHttpProtocol(t))return[null,null];var i=t.href,n=i.substring(0,this.pageUrl.length),r=this._getPathname(i,n),s={original:i,protocol:t.protocol,origin:n,pathname:r,href:n+r};return this._isLinkOk(s)?[s,t]:[null,null]}},{key:"_getPathname",value:function(e,t){var i=t?e.substring(this.pageUrl.length):e;return i.startsWith("/")||(i="/"+i),this._shouldAddTrailingSlash(i)?i+"/":i}},{key:"_shouldAddTrailingSlash",value:function(e){return this.config.usesTrailingSlash&&!e.endsWith("/")&&!this.regex.fileExtensions.test(e)}},{key:"_isLinkOk",value:function(e){return null!==e&&"object"===(void 0===e?"undefined":o(e))&&(!this.processedLinks.has(e.href)&&(!!this._isInternal(e)&&(!this._isQueryString(e.href)&&(!this._isAnchor(e.href)&&(!this._isExcluded(e.href)&&!this._isImage(e.href))))))}},{key:"_isAnchor",value:function(e){return-1!==e.indexOf("#")}},{key:"_isExcluded",value:function(e){return this.regex.excludeUris.test(e)}},{key:"_isHttpProtocol",value:function(e){return"http:"===e.protocol||"https:"===e.protocol}},{key:"_isImage",value:function(e){return this.regex.images.test(e)}},{key:"_isInternal",value:function(e){return e.origin===this.pageUrl}},{key:"_isQueryString",value:function(e){return-1!==e.indexOf("?")}},{key:"_resetAddLinkTask",value:function(){this.addLinkTimeoutId&&(clearTimeout(this.addLinkTimeoutId),this.addLinkTimeoutId=null)}}],[{key:"run",value:function(){"undefined"!=typeof RocketPreloadLinksConfig&&new i(new RocketBrowserCompatabilityChecker({capture:!0,passive:!0}),RocketPreloadLinksConfig).init()}}]),i}();t.run();